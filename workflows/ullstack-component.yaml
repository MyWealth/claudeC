## ğŸš€ å®Œæ•´å·¥ä½œæµï¼šå‰ç«¯ + åç«¯å¯¹æ¥

```yaml
# .claude/workflows/fullstack-component.yaml
name: fullstack-component
description: ä»åç«¯æ¥å£åˆ°å‰ç«¯ç»„ä»¶çš„å®Œæ•´å¼€å‘æµç¨‹
version: "3.0.0"
category: fullstack

# ========== é…ç½® ==========
config:
  api:
    swagger_url: "{{env.VITE_API_BASE_URL}}/v3/api-docs"
    base_path: "/api/v1"
  output:
    types_dir: "src/types/api"
    api_dir: "src/api"
    mocks_dir: "src/mocks/handlers"
    composables_dir: "src/composables/api"

# ========== è§¦å‘å‚æ•° ==========
inputs:
  - name: api_endpoint
    type: string
    required: true
    description: åç«¯æ¥å£è·¯å¾„ï¼Œå¦‚ /users æˆ–å®Œæ•´çš„ URL
    
  - name: http_method
    type: string
    required: false
    default: "GET"
    enum: [GET, POST, PUT, PATCH, DELETE]
    
  - name: component_purpose
    type: string
    required: true
    description: å‰ç«¯ç»„ä»¶ç”¨é€”æè¿°

# ========== æ‰§è¡Œæ­¥éª¤ ==========
steps:
  # ===== é˜¶æ®µ 1: API è§£æä¸å»ºæ¨¡ =====
  
  - id: parse_api
    name: parse-api-document
    description: ğŸ” è§£æåç«¯ API æ–‡æ¡£
    agent: api-integrator
    skill: api-parser
    
    inputs:
      api_source: "{{config.api.swagger_url}}"
      endpoint_path: "{{inputs.api_endpoint}}"
      method: "{{inputs.http_method}}"
    
    outputs:
      endpoint_info: "{{response.endpoint_info}}"
      request_schema: "{{response.request_schema}}"
      response_schema: "{{response.response_schema}}"
    
    on_error:
      action: prompt_user
      message: "æ— æ³•è‡ªåŠ¨è§£æ API æ–‡æ¡£ï¼Œè¯·æ‰‹åŠ¨æä¾›æ¥å£ä¿¡æ¯"
      fallback_input:
        endpoint_info: "{{user_input}}"

  - id: generate_request_types
    name: generate-request-types
    description: ğŸ“ ç”Ÿæˆè¯·æ±‚å‚æ•°ç±»å‹
    agent: type-guardian
    skill: type-generator
    
    condition: "{{steps.parse_api.outputs.request_schema != null}}"
    
    inputs:
      schema: "{{steps.parse_api.outputs.request_schema}}"
      name: "{{pascalCase(steps.parse_api.outputs.endpoint_info.operationId)}}Request"
      include_zod: true
    
    outputs:
      request_types: "{{response.types_code}}"
      request_zod: "{{response.zod_schema}}"
      request_mock: "{{response.mock_factory}}"
    
    post_action:
      type: write_file
      path: "{{config.output.types_dir}}/{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.request.ts"
      content: |
        // è¯·æ±‚ç±»å‹
        {{steps.generate_request_types.outputs.request_types}}
        
        // Zod Schema
        {{steps.generate_request_types.outputs.request_zod}}
        
        // Mock å·¥å‚
        {{steps.generate_request_types.outputs.request_mock}}

  - id: generate_response_types
    name: generate-response-types
    description: ğŸ“ ç”Ÿæˆå“åº”æ•°æ®ç±»å‹
    agent: type-guardian
    skill: type-generator
    
    inputs:
      schema: "{{steps.parse_api.outputs.response_schema}}"
      name: "{{pascalCase(steps.parse_api.outputs.endpoint_info.operationId)}}Response"
      include_zod: true
    
    outputs:
      response_types: "{{response.types_code}}"
      response_zod: "{{response.zod_schema}}"
      response_mock: "{{response.mock_factory}}"
    
    post_action:
      type: write_file
      path: "{{config.output.types_dir}}/{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.response.ts"
      content: |
        {{steps.generate_response_types.outputs.response_types}}
        
        {{steps.generate_response_types.outputs.response_zod}}
        
        {{steps.generate_response_types.outputs.response_mock}}

  # ===== é˜¶æ®µ 2: API å®¢æˆ·ç«¯å°è£… =====
  
  - id: generate_api_client
    name: generate-api-client
    description: ğŸ”Œ ç”Ÿæˆç±»å‹å®‰å…¨çš„ API å®¢æˆ·ç«¯
    agent: api-integrator
    
    prompt: |
      åŸºäºä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆ API å®¢æˆ·ç«¯å‡½æ•°ï¼š
      
      ## ç«¯ç‚¹
      {{to_json(steps.parse_api.outputs.endpoint_info)}}
      
      ## è¯·æ±‚ç±»å‹
      ```typescript
      {{steps.generate_request_types.outputs.request_types}}
      ```
      
      ## å“åº”ç±»å‹
      ```typescript
      {{steps.generate_response_types.outputs.response_types}}
      ```
      
      ## è¦æ±‚
      1. ä½¿ç”¨é¡¹ç›®å°è£…çš„ httpClientï¼ˆåŸºäº ofetch/axiosï¼‰
      2. å‡½æ•°åï¼š`{{camelCase(steps.parse_api.outputs.endpoint_info.operationId)}}`
      3. å®Œæ•´çš„ JSDoc æ³¨é‡Š
      4. è‡ªåŠ¨æ³¨å…¥ Authorization header
      5. å“åº”æ‹¦æˆªï¼šè‡ªåŠ¨è§£æ code/data/message ç»“æ„
      6. é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€è½¬æ¢ä¸º ApiError
      
      ## è¾“å‡º
      è¾“å‡ºå®Œæ•´çš„ TypeScript ä»£ç 
      
    outputs:
      api_function_code: "{{extract_code_block(response, 'typescript')}}"
      api_function_name: "{{steps.parse_api.outputs.endpoint_info.operationId}}"
    
    post_action:
      type: write_file
      path: "{{config.output.api_dir}}/{{kebabCase(steps.parse_api.outputs.endpoint_info.tags[0])}}.ts"
      mode: append
      content: "{{steps.generate_api_client.outputs.api_function_code}}"

  # ===== é˜¶æ®µ 3: Mock æ•°æ® =====
  
  - id: generate_msw
    name: generate-msw-handler
    description: ğŸ­ ç”Ÿæˆ MSW Mock å¤„ç†å™¨
    agent: api-integrator
    skill: mock-generator
    
    inputs:
      endpoint_info: "{{steps.parse_api.outputs.endpoint_info}}"
      types_code: |
        {{steps.generate_response_types.outputs.response_types}}
        {{steps.generate_response_types.outputs.response_mock}}
    
    outputs:
      msw_handler_code: "{{response.msw_handler}}"
      mock_scenarios: "{{response.mock_data}}"
    
    post_action:
      type: write_file
      path: "{{config.output.mocks_dir}}/{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.ts"
      content: "{{steps.generate_msw.outputs.msw_handler_code}}"

  # ===== é˜¶æ®µ 4: Vue Composable =====
  
  - id: generate_composable
    name: generate-api-composable
    description: ğŸ§© ç”Ÿæˆ useXxx ç»„åˆå¼å‡½æ•°
    agent: api-integrator
    skill: composable-generator
    
    inputs:
      name: "use{{pascalCase(steps.parse_api.outputs.endpoint_info.operationId)}}"
      purpose: "å¯¹æ¥åç«¯æ¥å£ï¼š{{steps.parse_api.outputs.endpoint_info.summary}}"
      source_type: "external_api"
      api_function: "{{steps.generate_api_client.outputs.api_function_name}}"
      has_params: "{{steps.parse_api.outputs.endpoint_info.parameters | length > 0}}"
      is_list: "{{steps.parse_api.outputs.endpoint_info.operationId includes 'List'}}"
    
    prompt: |
      ç”Ÿæˆ Vue 3 ç»„åˆå¼å‡½æ•°ï¼Œå°è£… API è°ƒç”¨ï¼š
      
      ## API å‡½æ•°
      ```typescript
      import { {{steps.generate_api_client.outputs.api_function_name}} } from '{{config.output.api_dir}}';
      
      {{steps.generate_api_client.outputs.api_function_code}}
      ```
      
      ## è¦æ±‚
      1. ä½¿ç”¨ Vue Query (TanStack Query Vue) æˆ–åŸç”Ÿå®ç°
      2. æ”¯æŒå‚æ•°å“åº”å¼ï¼ˆcomputed/ref ä½œä¸ºè¾“å…¥ï¼‰
      3. è‡ªåŠ¨é‡è¯•ç­–ç•¥ï¼ˆå¤±è´¥ 3 æ¬¡ï¼‰
      4. æ”¯æŒæ‰‹åŠ¨åˆ·æ–°
      5. ç¼“å­˜ç­–ç•¥é…ç½®
      
      ## è¿”å›ç»“æ„
      ```typescript
      {
        data,           // å“åº”æ•°æ®
        isLoading,      // é¦–æ¬¡åŠ è½½
        isFetching,     // åå°åˆ·æ–°
        isError,
        error,          // ApiError
        refetch,        // æ‰‹åŠ¨åˆ·æ–°
        invalidate,     // å¤±æ•ˆç¼“å­˜
      }
      ```
      
    outputs:
      composable_code: "{{extract_code_block(response, 'typescript')}}"
      composable_name: "use{{pascalCase(steps.parse_api.outputs.endpoint_info.operationId)}}"
    
    post_action:
      type: write_file
      path: "{{config.output.composables_dir}}/use-{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.ts"
      content: "{{steps.generate_composable.outputs.composable_code}}"

  # ===== é˜¶æ®µ 5: å‰ç«¯ç»„ä»¶ =====
  
  - id: analyze_component
    name: analyze-component-needs
    description: ğŸ¯ åˆ†æç»„ä»¶éœ€æ±‚
    agent: vue-architect
    
    prompt: |
      åŸºäºä»¥ä¸‹ API ä¿¡æ¯ï¼Œåˆ†æå‰ç«¯ç»„ä»¶éœ€æ±‚ï¼š
      
      ## æ¥å£ç”¨é€”
      {{inputs.component_purpose}}
      
      ## API ç«¯ç‚¹
      {{steps.parse_api.outputs.endpoint_info.summary}}
      
      ## å“åº”æ•°æ®ç»“æ„
      {{to_json(steps.parse_api.outputs.response_schema)}}
      
      ## ä»»åŠ¡
      1. ç¡®å®šç»„ä»¶ç±»å‹ï¼ˆList/Detail/Form/Cardï¼‰
      2. è¯†åˆ«éœ€è¦çš„ Propsï¼ˆå¦‚ç­›é€‰æ¡ä»¶ï¼‰
      3. ç¡®å®šçŠ¶æ€ç®¡ç†ï¼ˆæ˜¯å¦éœ€è¦ Piniaï¼‰
      4. ç¡®å®š UI çŠ¶æ€ï¼ˆloading/skeleton/error/emptyï¼‰
      
      è¾“å‡º JSONï¼š
      {
        "component_type": "list",
        "component_name": "UserList",
        "props": [...],
        "features": ["loading", "pagination", "refresh"],
        "slots": ["item", "empty"]
      }
      
    outputs:
      component_design: "{{parse_json(response)}}"

  - id: generate_component
    name: generate-vue-component
    description: ğŸ¨ ç”Ÿæˆå¯¹æ¥ API çš„ Vue ç»„ä»¶
    agent: vue-architect
    skill: sfc-generator
    
    inputs:
      component_name: "{{steps.analyze_component.outputs.component_design.component_name}}"
      description: "{{inputs.component_purpose}}"
      composable: "{{steps.generate_composable.outputs.composable_name}}"
      props: "{{steps.analyze_component.outputs.component_design.props}}"
      features: "{{steps.analyze_component.outputs.component_design.features}}"
      slots: "{{steps.analyze_component.outputs.component_design.slots}}"
      styling: "tailwind"
    
    prompt: |
      ç”Ÿæˆä½¿ç”¨ä»¥ä¸‹ composable çš„ Vue ç»„ä»¶ï¼š
      
      ## Composable
      ```typescript
      {{steps.generate_composable.outputs.composable_code}}
      ```
      
      ## ä½¿ç”¨æ–¹å¼
      ```typescript
      const { data, isLoading, isError, error, refetch } = {{steps.generate_composable.outputs.composable_name}}(params);
      ```
      
      ## ç»„ä»¶è¦æ±‚
      1. Props ä¸ Composable å‚æ•°ç»‘å®š
      2. è‡ªåŠ¨å¤„ç† loading/error/empty çŠ¶æ€
      3. æ”¯æŒæ‰‹åŠ¨åˆ·æ–°ï¼ˆåˆ·æ–°æŒ‰é’®ï¼‰
      4. å“åº”å¼å‚æ•°å˜åŒ–è‡ªåŠ¨é‡æ–°è·å–æ•°æ®
      5. æ·»åŠ é”™è¯¯é‡è¯• UI
      
      è¾“å‡ºå®Œæ•´çš„ .vue æ–‡ä»¶
      
    outputs:
      component_code: "{{response.code}}"
      component_filename: "{{response.filename}}"
    
    post_action:
      type: write_file
      path: "src/components/{{steps.generate_component.outputs.component_filename}}"
      content: "{{steps.generate_component.outputs.component_code}}"

  # ===== é˜¶æ®µ 6: é”™è¯¯å¤„ç†ä¸è¾¹ç•Œ =====
  
  - id: error_boundary
    name: setup-error-handling
    description: ğŸ›¡ï¸ é…ç½®é”™è¯¯å¤„ç†
    agent: api-integrator
    
    prompt: |
      ä¸ºä»¥ä¸‹ API è®¾è®¡é”™è¯¯å¤„ç†ç­–ç•¥ï¼š
      
      ## é”™è¯¯ç 
      {{steps.parse_api.outputs.endpoint_info.responses}}
      
      ## è¦æ±‚
      1. é”™è¯¯ç æ˜ å°„åˆ°ç”¨æˆ·å‹å¥½æç¤º
      2. å…¨å±€é”™è¯¯æ‹¦æˆªï¼ˆ401 è·³è½¬ç™»å½•ï¼Œ403 æ— æƒé™ï¼‰
      3. ç»„ä»¶çº§é”™è¯¯å…œåº•ï¼ˆError Boundaryï¼‰
      4. é‡è¯•ç­–ç•¥ï¼ˆç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•ï¼‰
      
      è¾“å‡ºï¼š
      - error-handler.ts é…ç½®
      - ç»„ä»¶å†…çš„é”™è¯¯å±•ç¤º UI ä»£ç 
      
    outputs:
      error_config: "{{response.config}}"
      error_ui_component: "{{response.error_component}}"

  # ===== é˜¶æ®µ 7: æµ‹è¯•ç”Ÿæˆ =====
  
  - id: generate_tests
    name: generate-api-tests
    description: ğŸ§ª ç”Ÿæˆ API æµ‹è¯•
    agent: testing-guru
    
    prompt: |
      ç”Ÿæˆ API ç›¸å…³æµ‹è¯•ï¼š
      
      ## æµ‹è¯•èŒƒå›´
      1. API å®¢æˆ·ç«¯å•å…ƒæµ‹è¯•ï¼ˆmsw æ‹¦æˆªï¼‰
      2. Composable æµ‹è¯•ï¼ˆVue Test Utilsï¼‰
      3. ç»„ä»¶é›†æˆæµ‹è¯•
      
      ## API ä¿¡æ¯
      {{to_json(steps.parse_api.outputs.endpoint_info)}}
      
      ## Composable
      {{steps.generate_composable.outputs.composable_code}}
      
      è¾“å‡ºæµ‹è¯•æ–‡ä»¶ä»£ç 
      
    outputs:
      api_test: "{{response.api_test}}"
      composable_test: "{{response.composable_test}}"
      component_test: "{{response.component_test}}"

# ========== å·¥ä½œæµè¾“å‡º ==========
outputs:
  summary: |
    âœ… åç«¯æ¥å£å¯¹æ¥å®Œæˆï¼
    
    ğŸ“¡ API ç«¯ç‚¹: {{inputs.http_method}} {{inputs.api_endpoint}}
    
    ğŸ“ ç”Ÿæˆæ–‡ä»¶:
    â”œâ”€ ç±»å‹å®šä¹‰: {{config.output.types_dir}}/{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.*
    â”œâ”€ API å®¢æˆ·ç«¯: {{config.output.api_dir}}/{{kebabCase(steps.parse_api.outputs.endpoint_info.tags[0])}}.ts
    â”œâ”€ Mock æ•°æ®: {{config.output.mocks_dir}}/{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.ts
    â”œâ”€ Composable: {{config.output.composables_dir}}/use-{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.ts
    â””â”€ ç»„ä»¶: src/components/{{steps.generate_component.outputs.component_filename}}
    
    ğŸ­ Mock å·²å¯ç”¨ï¼Œå¼€å‘ç¯å¢ƒå°†è‡ªåŠ¨æ‹¦æˆªè¯·æ±‚
    
    ğŸ“ ä¸‹ä¸€æ­¥:
    1. åœ¨ç»„ä»¶ä¸­å¯¼å…¥å¹¶ä½¿ç”¨
    2. æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ Props
    3. æ·»åŠ ä¸šåŠ¡é€»è¾‘ï¼ˆç­›é€‰ã€æ’åºç­‰ï¼‰
    
  next_steps:
    - "è¿è¡Œæµ‹è¯•: npm test {{steps.generate_composable.outputs.composable_name}}"
    - "å¯åŠ¨å¼€å‘æœåŠ¡å™¨: npm run dev"
    - "æŸ¥çœ‹ Mock æ•°æ®: è®¿é—® {{inputs.api_endpoint}}"

post_workflow:
  - type: open_files
    files:
      - "{{config.output.composables_dir}}/use-{{kebabCase(steps.parse_api.outputs.endpoint_info.operationId)}}.ts"
      - "src/components/{{steps.generate_component.outputs.component_filename}}"